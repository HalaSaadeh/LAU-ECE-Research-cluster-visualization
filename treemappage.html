<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
<style type="text/css">
    .toolTip {
        position: absolute;
        display: none;
        width: auto;
        height: auto;
        background: none repeat scroll 0 0 white;
        border: 0 none;
        border-radius: 8px 8px 8px 8px;
        box-shadow: -3px 3px 15px #888888;
        color: black;
        font: 12px sans-serif;
        padding: 5px;
        text-align: center;
    }
</style>


<script src="https://d3js.org/d3.v4.min.js"></script>

<div id="viz">
    <svg style="width:900px;height:800px;"></svg>
</div>
<script>

    var data = d3.json('cluster_topic_index.json', function (data) {
        var stratify = d3.stratify()
            .parentId(function (d) {
                return d.id.substring(0, d.id.lastIndexOf("."));
            })
            .id(function (d) {
                return d.id;
            });

        var root = stratify(data).sum(function (d) {
            return 1;
        })
            .sort(function (a, b) {
                return b.height - a.height || b.value - a.value;
            });
        console.log(root);
        var depthScale = d3.scaleOrdinal()
            .range(["#5EAFC6", "#FE9922", "#93c464", "#75739F"]);

        var treemapLayout = d3.treemap()
            .size([900, 700])
            .padding(d => d.depth + 10);

        treemapLayout(root);

        // Create the rects
        d3.select("svg")
            .selectAll("rect")
            .data(root.descendants()
                    .filter(function(d) {
                     return d.depth <=3;
                    }))
            .enter()
            .append("rect")
            .attr("x", d => d.x0)
            .attr("y", d => d.y0)
            .attr("width", d => d.x1 - d.x0)
            .attr("height", d => d.y1 - d.y0)
            .style("fill", d => depthScale(d.depth))
            .style("stroke", "black")
            .on("mousemove", function (d) { // Create the text tooltip
                tool.style("left", d3.event.pageX + 10 + "px")
                tool.style("top", d3.event.pageY - 20 + "px")
                tool.style("display", "inline-block");
                tool.html(d.data.id + "\nTopic:" + d.data.topic);
            }).on("mouseout", function (d) {
            tool.style("display", "none");
        });

        // Create the id labels
        // d3.select("svg")
        //     .selectAll("text")
        //     .data(root.leaves())
        //     .enter()
        //     .append("text")
        //     .attr("x", function (d) {
        //         return d.x0 + 5
        //     })    // +10 to adjust position (more right)
        //     .attr("y", function (d) {
        //         return d.y0 + 20
        //     })    // +20 to adjust position (lower)
        //     .text(function (d) {
        //         return d.data.id
        //     })
        //     .attr("font-size", d => {
        //         return "0.9em";
        //     })
        //     .attr("fill", "black");

        var tool = d3.select("body").append("div").attr("class", "toolTip");

        // function zoomOut()
    })

</script>
</body>
</html>